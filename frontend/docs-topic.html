<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doc Topics | Notekeeper</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg fixed-top shadow-sm">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-brand fw-bold logo-text" href="/">Notekeeper</a>

      <!-- Toggle Button for Mobile -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Links + Search -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="/docs-list.html">Docs</a></li>
          <li class="nav-item"><a class="nav-link" href="/add-topic.html">Add Topic</a></li>
          <li class="nav-item"><a class="nav-link" href="/signup.html">Signup</a></li>
          <li class="nav-item"><a class="nav-link" href="/login.html">Login</a></li>
        </ul>

        <!-- Searchbar -->
        <form class="d-flex ms-lg-3 mt-2 mt-lg-0" role="search">
          <input class="form-control search-input" type="search" placeholder="Search..." aria-label="Search">
          <button class="btn search-btn ms-2 border rounded" type="submit">Go</button>
        </form>
      </div>
    </div>
  </nav>

  <!-- Topics Section -->
  <div class="container mt-5 pt-5">
    <h2 class="section-title mb-4">React Topics</h2>
    <ul class="list-group list-group-flush mb-5">
      <!-- topics elements -->

    </ul>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item disabled">
          <a class="page-link" href="#" aria-label="Previous">&laquo;</a>
        </li>
        <li class="page-item"><a class="page-link" href="">1</a></li>
        <li class="page-item active"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item"><a class="page-link" href="#">4</a></li>
        <li class="page-item"><a class="page-link" href="#">5</a></li>
        <li class="page-item">
          <a class="page-link" href="#" aria-label="Next">&raquo;</a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Footer Section -->
  <footer class="footer py-4">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
      <!-- Brand -->
      <div class="footer-brand mb-3 mb-md-0">
        <h5>Notekeeper</h5>
        <p class="small">Â© 2025 Notekeeper. All rights reserved.</p>
      </div>

      <!-- Social Icons -->
      <div class="footer-social">
        <a href="#"><i class="bi bi-twitter"></i></a>
        <a href="#"><i class="bi bi-facebook"></i></a>
        <a href="#"><i class="bi bi-github"></i></a>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- config.js -->
  <script src="config.js"></script>
  <script src="script.js"></script>
  
 <script>
document.addEventListener("DOMContentLoaded", async () => {
  // Get category & page from URL params
  const urlParams = new URLSearchParams(window.location.search);
  const category = urlParams.get("category");
  const page = parseInt(urlParams.get("page")) || 1; // default page = 1

  // Update heading
  if (category) {
    document.querySelector(".section-title").textContent = `${category} Topics`;
  }

  try {
    // Fetch blogs by category & page
    let response = await fetch(`${CONFIG.BACKEND_URL}/blogs?category=${encodeURIComponent(category)}&page=${page}`, {
      method: "GET",
      credentials: "include"
    });

    let data = await response.json();
    

    if (data.success) {
      const blogs = data.data;
      const totalPages = data.pages;
      const listGroup = document.querySelector(".list-group");

      // Clear old items
      listGroup.innerHTML = "";

      // Render blogs
      blogs.forEach(blog => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";

        li.innerHTML = `
          <a href="/doc.html?id=${blog._id}" class="text-decoration-none">${blog.topic}</a>
          <button class="btn btn-danger btn-sm delete-btn" data-id="${blog._id}">
            Delete
          </button>
        `;

        listGroup.appendChild(li);
      });

      // Attach delete handlers
      document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", async (e) => {
          const blogId = e.target.getAttribute("data-id");
          if (!confirm("Do you want to delete this blog?")) return;

          try {
            const res = await fetch(`http://localhost:5000/blogs/delete/${blogId}`, {
              method: "DELETE",
              credentials: "include"
            });

            const result = await res.json();

            if (result.success) {
              alert("Blog deleted successfully!");
              e.target.closest("li").remove();
            } else {
              alert("Failed to delete blog: " + result.message);
            }
          } catch (err) {
            console.error("Error deleting blog:", err);
            alert("Something went wrong while deleting.");
          }
        });
      });

      // --- Pagination Rendering ---
      const pagination = document.querySelector(".pagination");
      pagination.innerHTML = "";

      // Previous button
      const prevLi = document.createElement("li");
      prevLi.className = `page-item ${page === 1 ? "disabled" : ""}`;
      prevLi.innerHTML = `
        <a class="page-link" href="?category=${encodeURIComponent(category)}&page=${page - 1}" aria-label="Previous">&laquo;</a>
      `;
      pagination.appendChild(prevLi);

      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement("li");
        li.className = `page-item ${i === page ? "active" : ""}`;
        li.innerHTML = `
          <a class="page-link" href="?category=${encodeURIComponent(category)}&page=${i}">${i}</a>
        `;
        pagination.appendChild(li);
      }

      // Next button
      const nextLi = document.createElement("li");
      nextLi.className = `page-item ${page === totalPages ? "disabled" : ""}`;
      nextLi.innerHTML = `
        <a class="page-link" href="?category=${encodeURIComponent(category)}&page=${page + 1}" aria-label="Next">&raquo;</a>
      `;
      pagination.appendChild(nextLi);

    } else {
      console.error("Failed to fetch blogs:", data.message);
    }
  } catch (err) {
    console.error("Error fetching blogs:", err);
  }
});
</script>



</body>

</html>